Index: scripts/services/modprobe
===================================================================
RCS file: /var/cvs/logwatch/scripts/services/modprobe,v
retrieving revision 1.8
diff -u -r1.8 modprobe
--- scripts/services/modprobe	3 Nov 2003 05:07:25 -0000	1.8
+++ scripts/services/modprobe	3 Dec 2003 14:02:21 -0000
@@ -14,29 +14,42 @@
 #$Detail = $ENV{'LOGWATCH_DETAIL_LEVEL'} || 0;
 
 while (defined($ThisLine = <STDIN>)) {
-   chomp($ThisLine);
-   if ( $ThisLine =~ s/^modprobe: Can\'t locate module ([\w-]+)\s*$/$1/ ) {
-     $Modules{$ThisLine}++;
-   } elsif ( $ThisLine =~ s/^FATAL: Module (.*) not found./$1/) {
-     $Modules{$ThisLine}++;
-   } else {
-      $OtherList{$ThisLine}++;
-   }
+	chomp($ThisLine);
+	if ( $ThisLine =~ s/^modprobe: Can\'t locate module ([\w-]+)\s*$/$1/ ) {
+		$Modules{$ThisLine}++;
+	} elsif ( $ThisLine =~ s/^FATAL: Module (.*) not found./$1/) {
+		$Modules{$ThisLine}++;
+	} elsif ( ($Module,$Reason) = ( $ThisLine =~ /WARNING: Error inserting ([^ ]* \([^ ]*\)): (.*)$/ ) ) {
+		$ErrorInsert{$Module}{$Reason}++;
+	} else {
+		$OtherList{$ThisLine}++;
+	}
 }
 
 if (keys %Modules) {
-   print "\nCan't locate these modules:\n";
-   foreach my $ThisOne (keys %Modules) {
-      print "   " . $ThisOne . ": " . $Modules{$ThisOne} . " Time(s)\n";
-   }
+	print "\nCan't locate these modules:\n";
+	foreach my $ThisOne (sort {$a cmp $b} keys %Modules) {
+		print "   " . $ThisOne . ": " . $Modules{$ThisOne} . " Time(s)\n";
+	}
+}
+
+if (keys %ErrorInsert) {
+	print "\nErrors inserting modules:\n";
+	foreach $Module (sort {$a cmp $b} keys %ErrorInsert) {
+		print "   $Module :\n";
+		foreach $Reason (sort {$a cmp $b} keys %{$ErrorInsert{$Module}}) {
+			print "      $Reason : $ErrorInsert{$Module}{$Reason} Time(s)\n";
+		}
+	}
 }
 
 if (keys %OtherList) {
-   print "\n**Unmatched Entries**\n";
-   foreach $line (sort {$a cmp $b} keys %OtherList) {
-      print "$line: $OtherList{$line} Time(s)\n";
-   }
+	print "\n**Unmatched Entries**\n";
+	foreach $line (sort {$a cmp $b} keys %OtherList) {
+		print "$line: $OtherList{$line} Time(s)\n";
+	}
 }
 
 exit(0);
 
+# vi: shiftwidth=4 tabstop=4
